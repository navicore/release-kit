# Init Command Design

## Goal

Make it **trivially easy** to go from "I have audio files" to "working album site" with zero manual TOML editing.

## Ideal Workflow

```bash
# User has a directory with audio files
my-album/
├── 01-infrastructure-hum.flac
├── 02-resonant-decay.flac
├── 03-harmonic-collapse.flac
└── cover.jpg

# Run init
$ release-kit init my-album/

Analyzing directory: my-album/
✓ Found 3 audio files
✓ Detected cover art: cover.jpg
✓ Extracted metadata from files

Generated structure:
  my-album/
  ├── album.toml           ← Generated with smart defaults
  ├── artwork/
  │   └── cover.jpg        ← Moved here
  ├── audio/
  │   ├── 01-infrastructure-hum.flac
  │   ├── 02-resonant-decay.flac
  │   └── 03-harmonic-collapse.flac
  └── notes/
      └── album.md         ← Template

Next steps:
  1. Edit album.toml (set artist name, release date, etc.)
  2. Add liner notes to notes/album.md
  3. Preview: release-kit preview my-album/

# Can immediately preview with defaults
$ release-kit preview my-album/
Preview: http://localhost:8080
✓ Site generated
```

## Init Command Behavior

### Modes

**Mode 1: Smart init (directory with audio files)**
```bash
release-kit init my-album/
```
- Scans directory for audio files (`.flac`, `.wav`, `.mp3`, `.ogg`)
- Auto-detects cover art (`cover.{jpg,png}`, `artwork.{jpg,png}`, `folder.{jpg,png}`)
- Extracts metadata from audio files (duration, bitrate)
- Generates track titles from filenames (e.g., `01-track-name.flac` → "Track Name")
- Creates `album.toml` with detected data + placeholder artist info
- Organizes files into proper structure
- Creates template `notes/album.md`

**Mode 2: Empty init (create from scratch)**
```bash
release-kit init --empty my-album/
```
- Creates directory structure
- Creates minimal `album.toml` template
- User manually adds audio files and edits config

### Auto-Detection Logic

#### Track Title Extraction

```
Filename Pattern           → Extracted Title
────────────────────────────────────────────
01-infrastructure-hum.flac → "Infrastructure Hum"
01_infrastructure_hum.flac → "Infrastructure Hum"
track-01-hum.flac          → "Hum"
Infrastructure Hum.flac    → "Infrastructure Hum"
01 - Hum.flac              → "Hum"
```

Rules:
1. Strip track numbers (`01`, `01.`, `01-`, `01_`, `track-01`, etc.)
2. Replace underscores/hyphens with spaces
3. Title-case the result
4. If result is empty, use "Track N"

#### Cover Art Detection

Search order:
1. `cover.jpg` / `cover.png`
2. `artwork.jpg` / `artwork.png`
3. `folder.jpg` / `folder.png`
4. `album.jpg` / `album.png`
5. First `.jpg` or `.png` in directory

#### Audio Metadata Extraction

Use `lofty` crate to read:
- Duration
- Format (FLAC, MP3, WAV, etc.)
- Bitrate
- Sample rate
- Optionally: ID3 tags (but TOML is source of truth, so just for defaults)

### Generated album.toml Template

```toml
# Generated by release-kit init
# Edit this file to customize your album

[album]
title = "My Album"  # TODO: Set album title
artist = "Artist Name"  # TODO: Set artist name
release_date = "2025-11-15"  # TODO: Set release date
summary = "Description of this album"  # TODO: Add summary
genre = ["experimental"]  # TODO: Set genres
license = "CC BY-NC-SA 4.0"
liner_notes = "notes/album.md"

[artist]
name = "Artist Name"  # TODO: Set artist name
rss_author_email = "artist@example.com"  # TODO: Set email

[site]
domain = "my-album.example.com"  # TODO: Set domain
theme = "default"
accent_color = "#ff6b35"

# Auto-detected tracks (edit titles/add liner notes as needed)
[[track]]
file = "audio/01-infrastructure-hum.flac"
title = "Infrastructure Hum"
duration = "7:23"  # Auto-detected

[[track]]
file = "audio/02-resonant-decay.flac"
title = "Resonant Decay"
duration = "5:47"  # Auto-detected

[[track]]
file = "audio/03-harmonic-collapse.flac"
title = "Harmonic Collapse"
duration = "9:12"  # Auto-detected

[distribution]
streaming_enabled = true
download_enabled = false

[hosting.cloudflare]
account_id = "your-cloudflare-account-id"  # TODO: Set from env or config
r2_bucket = "music-releases"
pages_project = "my-album"

[rss]
enabled = true
```

### Generated notes/album.md Template

```markdown
# Album Notes

Write about your album here. This is markdown, so you can use:

- **Bold** and *italic* text
- Lists and bullet points
- Links and images
- Code blocks
- Anything else markdown supports

## Recording Process

Describe how you made this album...

## Credits

Thanks to...
```

## Implementation Plan

### Phase 1: Basic Init
- Create directory structure
- Generate template `album.toml`
- Generate template `notes/album.md`

### Phase 2: Smart Detection
- Scan for audio files
- Extract metadata with `lofty`
- Auto-generate track entries
- Detect cover art

### Phase 3: Interactive Mode
- Prompt for artist name, album title
- Ask about license
- Confirm detected tracks
- Option to edit in $EDITOR

## CLI Options

```bash
release-kit init [OPTIONS] <PATH>

Arguments:
  <PATH>  Directory to initialize (must exist or will be created)

Options:
      --empty              Create empty structure (no auto-detection)
      --interactive, -i    Interactive mode (prompt for details)
      --force, -f          Overwrite existing album.toml if present
  -h, --help              Print help
```

## Error Handling

**Directory doesn't exist:**
```
Error: Directory 'my-album/' does not exist
Hint: Create it first: mkdir my-album/
```

**No audio files found:**
```
Warning: No audio files found in 'my-album/'
Creating empty structure. Add audio files to audio/ directory.
```

**album.toml already exists:**
```
Error: album.toml already exists
Hint: Use --force to overwrite, or delete it first
```

## Preview with Defaults

The generated site **must be previewable immediately** even with placeholder data. The preview command should:
- Accept missing/placeholder fields gracefully
- Show TODOs in the UI where artist needs to edit
- Still generate valid HTML/CSS

This allows the artist to see what their site will look like before filling in all details.

---

**Status:** Design complete, implementation pending
**Next:** Implement basic init in `crates/cli/src/commands/init.rs`
